<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- SEOåŸºæœ¬æƒ…å ± -->
    <title>ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ ULTIMATE - ç„¡æ–™ãƒ–ãƒ©ã‚¦ã‚¶ã‚²ãƒ¼ãƒ  | 7æ®µéšé›£æ˜“åº¦</title>
    <meta name="description" content="ãƒ–ãƒ©ã‚¦ã‚¶ã§éŠã¹ã‚‹æœ¬æ ¼ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ã‚²ãƒ¼ãƒ ï¼7æ®µéšã®é›£æ˜“åº¦ã€ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã€ã‚³ãƒ³ãƒœã‚·ã‚¹ãƒ†ãƒ æ­è¼‰ã€‚åˆå¿ƒè€…ã‹ã‚‰ä¸Šç´šè€…ã¾ã§æ¥½ã—ã‚ã‚‹ç„¡æ–™ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã€‚">
    <meta name="keywords" content="ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼,ç„¡æ–™ã‚²ãƒ¼ãƒ ,ãƒ–ãƒ©ã‚¦ã‚¶ã‚²ãƒ¼ãƒ ,ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ ,ãƒ¬ãƒˆãƒ­ã‚²ãƒ¼ãƒ ,HTML5ã‚²ãƒ¼ãƒ ,ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼,ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ ">
    <meta name="author" content="tomoya06257-beep">
    
    <!-- Open Graph (SNSå…±æœ‰ç”¨) -->
    <meta property="og:title" content="ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ ULTIMATE - ç„¡æ–™ãƒ–ãƒ©ã‚¦ã‚¶ã‚²ãƒ¼ãƒ ">
    <meta property="og:description" content="7æ®µéšã®é›£æ˜“åº¦ã§æ¥½ã—ã‚ã‚‹æœ¬æ ¼ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ï¼ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã‚„ã‚³ãƒ³ãƒœã‚·ã‚¹ãƒ†ãƒ æ­è¼‰ã®ç„¡æ–™ã‚²ãƒ¼ãƒ ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://superb-maamoul-1cd317.netlify.app">
    <meta property="og:site_name" content="ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ ULTIMATE">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ ULTIMATE">
    <meta name="twitter:description" content="ãƒ–ãƒ©ã‚¦ã‚¶ã§éŠã¹ã‚‹æœ¬æ ¼ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ï¼7æ®µéšé›£æ˜“åº¦ã§ç„¡é™ã«æ¥½ã—ã‚ã‚‹ã€‚">
    
    <!-- æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³è¨­å®š -->
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://superb-maamoul-1cd317.netlify.app">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f1e 100%);
            font-family: 'Orbitron', 'Arial', sans-serif;
            color: #fff;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        #gameContainer {
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.5);
            max-width: 100vw;
            max-height: 100vh;
        }
        canvas {
            display: block;
            background: #000;
            border: 3px solid #0ff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šæ¨ªç”»é¢ */
        @media (max-width: 896px) and (orientation: landscape) {
            body {
                justify-content: flex-start;
                padding: 5px 0;
            }
            #gameContainer {
                max-height: 95vh;
            }
            canvas {
                height: 95vh;
                width: auto;
            }
            #ui {
                padding: 8px 15px;
                font-size: 14px;
            }
            .stat {
                font-size: 14px;
            }
            #healthBar {
                width: 100px;
                height: 15px;
            }
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šç¸¦ç”»é¢ */
        @media (max-width: 768px) and (orientation: portrait) {
            #gameContainer {
                max-width: 100vw;
                max-height: 100vh;
            }
            canvas {
                width: 100vw;
                height: auto;
            }
            #ui {
                padding: 10px 10px;
                font-size: 12px;
            }
            .stat {
                font-size: 12px;
                gap: 5px;
            }
            #healthBar {
                width: 80px;
                height: 12px;
            }
            #permanentControls {
                display: none;
            }
        }
        
        /* iPhoneç‰¹åŒ–ã®èª¿æ•´ */
        @media only screen 
        and (min-device-width: 375px) 
        and (max-device-width: 896px) 
        and (-webkit-min-device-pixel-ratio: 2) {
            body {
                -webkit-overflow-scrolling: touch;
            }
            canvas {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
            }
        }
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
        }
        .stat {
            font-size: 20px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stat-label {
            color: #0ff;
            font-weight: bold;
        }
        #healthBar {
            width: 150px;
            height: 20px;
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid #f00;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        #healthFill {
            height: 100%;
            background: linear-gradient(to right, #ff0000, #ff6600);
            transition: width 0.3s;
            box-shadow: 0 0 10px #f00;
        }
        #gameOver, #startScreen, #difficultyScreen, #tutorialScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #0ff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            pointer-events: all;
        }
        #gameOver, #difficultyScreen, #tutorialScreen {
            display: none;
        }
        #tutorialScreen {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            text-align: left;
        }
        .tutorial-section {
            margin: 25px 0;
            padding: 20px;
            background: rgba(0, 255, 255, 0.05);
            border-left: 4px solid #0ff;
            border-radius: 10px;
        }
        .tutorial-section h2 {
            color: #0ff;
            margin-bottom: 15px;
            font-size: 24px;
            text-align: center;
        }
        .tutorial-section h3 {
            color: #ff0;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .controls-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        .control-key {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            color: #0ff;
            border: 2px solid #0ff;
            text-align: center;
        }
        .control-desc {
            padding: 8px;
            color: #fff;
        }
        .enemy-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        .enemy-visual {
            width: 60px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        .enemy-details {
            flex: 1;
        }
        .enemy-name {
            font-weight: bold;
            color: #ff0;
            font-size: 16px;
        }
        .enemy-description {
            color: #aaa;
            font-size: 14px;
            margin-top: 5px;
        }
        .powerup-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        .powerup-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid;
        }
        .powerup-health { border-color: #0f0; }
        .powerup-shield { border-color: #0ff; }
        .powerup-triple { border-color: #ff0; }
        .powerup-laser { border-color: #f0f; }
        .powerup-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        .powerup-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
        }
        .powerup-effect {
            font-size: 13px;
            color: #aaa;
        }
        .tips-list {
            list-style: none;
            padding: 0;
        }
        .tips-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        .tips-list li:before {
            content: "ğŸ’¡";
            position: absolute;
            left: 0;
        }
        .scroll-hint {
            text-align: center;
            color: #0ff;
            font-size: 14px;
            margin-top: 20px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šã‚¿ãƒƒãƒæ“ä½œãƒœã‚¿ãƒ³ */
        #mobileControls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: none;
            justify-content: space-between;
            padding: 0 20px;
            pointer-events: none;
            z-index: 50;
        }
        #mobileControls.show {
            display: flex;
        }
        .mobile-buttons {
            display: flex;
            gap: 10px;
            pointer-events: all;
        }
        .mobile-btn {
            width: 70px;
            height: 70px;
            background: rgba(0, 255, 255, 0.3);
            border: 3px solid #0ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #0ff;
            font-weight: bold;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            touch-action: manipulation;
            transition: all 0.1s;
        }
        .mobile-btn:active {
            background: rgba(0, 255, 255, 0.6);
            transform: scale(0.95);
        }
        .mobile-shoot-btn {
            width: 80px;
            height: 80px;
            background: rgba(255, 0, 255, 0.3);
            border-color: #f0f;
            font-size: 16px;
        }
        .mobile-shoot-btn:active {
            background: rgba(255, 0, 255, 0.6);
        }
        
        /* æ¨ªç”»é¢æ™‚ã®ãƒœã‚¿ãƒ³èª¿æ•´ */
        @media (max-width: 896px) and (orientation: landscape) {
            #mobileControls {
                bottom: 10px;
                padding: 0 10px;
            }
            .mobile-btn {
                width: 55px;
                height: 55px;
                font-size: 20px;
            }
            .mobile-shoot-btn {
                width: 65px;
                height: 65px;
                font-size: 14px;
            }
        }
        
        /* ç¸¦ç”»é¢æ™‚ã®ãƒœã‚¿ãƒ³èª¿æ•´ */
        @media (max-width: 768px) and (orientation: portrait) {
            #mobileControls {
                bottom: 15px;
                padding: 0 15px;
            }
            .mobile-btn {
                width: 65px;
                height: 65px;
                font-size: 22px;
            }
            .mobile-shoot-btn {
                width: 75px;
                height: 75px;
                font-size: 15px;
            }
        }
        /* æ“ä½œèª¬æ˜ï¼ˆå¸¸æ™‚è¡¨ç¤ºãƒ»å³ä¸Šï¼‰ */
        #permanentControls {
            position: absolute;
            top: 60px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #0ff;
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 12px;
            color: #fff;
            pointer-events: none;
            max-width: 200px;
        }
        #permanentControls h4 {
            color: #0ff;
            margin-bottom: 5px;
            font-size: 14px;
        }
        #permanentControls ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #permanentControls li {
            margin: 3px 0;
            line-height: 1.4;
        }
        /* ãƒ¢ãƒã‚¤ãƒ«æ¤œå‡ºæ™‚ã®èª¿æ•´ */
        @media (max-width: 768px) {
            #permanentControls {
                display: none; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯éè¡¨ç¤º */
            }
        }
        /* ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #startOverlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            pointer-events: all;
        }
        #startOverlay.show {
            display: flex;
        }
        #startOverlay .message {
            font-size: 32px;
            color: #0ff;
            text-shadow: 0 0 20px #0ff;
            animation: pulse 2s infinite;
        }
        .difficulty-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 30px;
            max-width: 900px;
        }
        .difficulty-btn {
            padding: 20px 12px;
            font-size: 16px;
            border: 3px solid;
            border-radius: 15px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .difficulty-btn:hover::before {
            left: 100%;
        }
        .difficulty-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px;
        }
        .difficulty-beginner {
            border-color: #0f0;
            color: #0f0;
        }
        .difficulty-beginner:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 30px #0f0;
        }
        .difficulty-easy {
            border-color: #9f0;
            color: #9f0;
        }
        .difficulty-easy:hover {
            background: rgba(153, 255, 0, 0.2);
            box-shadow: 0 0 30px #9f0;
        }
        .difficulty-normal {
            border-color: #ff0;
            color: #ff0;
        }
        .difficulty-normal:hover {
            background: rgba(255, 255, 0, 0.2);
            box-shadow: 0 0 30px #ff0;
        }
        .difficulty-advanced {
            border-color: #f60;
            color: #f60;
        }
        .difficulty-advanced:hover {
            background: rgba(255, 102, 0, 0.2);
            box-shadow: 0 0 30px #f60;
        }
        .difficulty-expert {
            border-color: #f90;
            color: #f90;
        }
        .difficulty-expert:hover {
            background: rgba(255, 153, 0, 0.2);
            box-shadow: 0 0 30px #f90;
        }
        .difficulty-master {
            border-color: #a020f0;
            color: #a020f0;
        }
        .difficulty-master:hover {
            background: rgba(160, 32, 240, 0.2);
            box-shadow: 0 0 30px #a020f0;
        }
        .difficulty-extreme {
            border-color: #f0f;
            color: #f0f;
        }
        .difficulty-extreme:hover {
            background: rgba(255, 0, 255, 0.2);
            box-shadow: 0 0 30px #f0f;
        }
        .difficulty-nightmare {
            border-color: #8b00ff;
            color: #8b00ff;
        }
        .difficulty-nightmare:hover {
            background: rgba(139, 0, 255, 0.2);
            box-shadow: 0 0 30px #8b00ff;
        }
        .difficulty-insane {
            border-color: #f00;
            color: #f00;
            animation: insanePulse 1.5s infinite;
        }
        .difficulty-insane:hover {
            background: rgba(255, 0, 0, 0.3);
            box-shadow: 0 0 40px #f00;
        }
        @keyframes insanePulse {
            0%, 100% { box-shadow: 0 0 10px #f00; }
            50% { box-shadow: 0 0 25px #f00; }
        }
        .difficulty-hell {
            border-color: #ff0000;
            color: #ff0000;
            animation: hellPulse 2s infinite;
        }
        .difficulty-hell:hover {
            background: rgba(255, 0, 0, 0.3);
            box-shadow: 0 0 40px #ff0000;
        }
        @keyframes hellPulse {
            0%, 100% { box-shadow: 0 0 10px #f00; }
            50% { box-shadow: 0 0 30px #f00; }
        }
        .difficulty-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .difficulty-desc {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.3;
        }
        .difficulty-level {
            font-size: 14px;
            margin-top: 5px;
            opacity: 0.9;
        }
        h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #0ff;
            background: linear-gradient(45deg, #0ff, #f0f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .btn {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(45deg, #0ff, #f0f);
            border: none;
            border-radius: 10px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        .btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
        }
        .controls {
            margin-top: 15px;
            font-size: 14px;
            color: #aaa;
        }
        .wave-info {
            font-size: 16px;
            margin: 10px 0;
            color: #0ff;
        }
        #combo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            font-weight: bold;
            color: #ff0;
            text-shadow: 0 0 20px #ff0;
            opacity: 0;
            pointer-events: none;
            animation: comboAnim 1s ease-out;
        }
        @keyframes comboAnim {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -80%) scale(1); }
        }
        #controlHints {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0ff;
            border-radius: 15px;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }
        #controlHints.show {
            opacity: 1;
        }
        .hint-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hint-keys {
            display: flex;
            gap: 5px;
        }
        .hint-key {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #0ff;
            border-radius: 5px;
            padding: 8px 12px;
            font-weight: bold;
            color: #0ff;
            min-width: 35px;
            text-align: center;
        }
        .hint-desc {
            color: #fff;
            font-size: 14px;
        }
        #powerupNotification {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        #powerupNotification.show {
            opacity: 1;
        }
        #powerupTimer {
            position: absolute;
            top: 140px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            color: #ff0;
            text-shadow: 0 0 10px #ff0;
            opacity: 0;
            pointer-events: none;
        }
        #powerupTimer.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="700"></canvas>
        <div id="ui">
            <div class="stat">
                <span class="stat-label">ã‚¹ã‚³ã‚¢:</span>
                <span id="score">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">WAVE:</span>
                <span id="wave">1</span>
            </div>
            <div class="stat">
                <div id="healthBar">
                    <div id="healthFill" style="width: 100%"></div>
                </div>
            </div>
        </div>
        <div id="startScreen">
            <h1>ğŸš€ SPACE INVADERS ğŸš€</h1>
            <div class="wave-info">ç©¶æ¥µã®ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä½“é¨“</div>
            <div class="controls">
                åœ°çƒã‚’ä¾µç•¥è€…ã‹ã‚‰å®ˆã‚ŠæŠœã‘ï¼<br>
                7æ®µéšã®é›£æ˜“åº¦ã§ç„¡é™ã®æŒ‘æˆ¦
            </div>
            <button class="btn" onclick="showTutorial()">ã‚²ãƒ¼ãƒ ã®èª¬æ˜ã‚’è¦‹ã‚‹</button>
            <button class="btn" onclick="showDifficulty()" style="margin-top: 15px; background: linear-gradient(45deg, #ff0, #f60);">ã™ãã«å§‹ã‚ã‚‹ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰</button>
        </div>
        <div id="tutorialScreen">
            <h1 style="text-align: center; margin-bottom: 30px;">ğŸ® ã‚²ãƒ¼ãƒ ã‚¬ã‚¤ãƒ‰</h1>
            
            <div class="tutorial-section">
                <h2>ğŸ“– ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h2>
                <p style="line-height: 1.8;">
                    åœ°çƒã«è¬ã®ä¾µç•¥è€…ãŸã¡ãŒè¿«ã£ã¦ããŸï¼<br>
                    ã‚ãªãŸã¯æœ€å¾Œã®é˜²è¡›ç·šã¨ã—ã¦ã€å®‡å®™æˆ¦é—˜æ©Ÿã‚’æ“ç¸¦ã—ã€æ³¢çŠ¶æ”»æ’ƒã‚’ä»•æ›ã‘ã¦ãã‚‹æ•µã‚’æ’ƒé€€ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚<br>
                    æœãŸã—ã¦äººé¡ã®å‘½é‹ã¯...ï¼ï¼Ÿ
                </p>
            </div>

            <div class="tutorial-section">
                <h2>ğŸ¯ ã‚²ãƒ¼ãƒ ã®ç›®çš„</h2>
                <p style="line-height: 1.8;">
                    âœ… ç”»é¢ä¸Šã®å…¨ã¦ã®æ•µã‚’å€’ã—ã¦ã‚¦ã‚§ãƒ¼ãƒ–ã‚’ã‚¯ãƒªã‚¢<br>
                    âœ… ã§ãã‚‹ã ã‘é«˜ã„ã‚¹ã‚³ã‚¢ã‚’ç²å¾—<br>
                    âœ… ã‚³ãƒ³ãƒœã‚’ç¹‹ã’ã¦ã‚¹ã‚³ã‚¢ã‚’å€å¢—<br>
                    âœ… ä½“åŠ›ãŒ0ã«ãªã‚‹å‰ã«ç”Ÿãå»¶ã³ã‚‹
                </p>
            </div>

            <div class="tutorial-section">
                <h2>ğŸ•¹ï¸ æ“ä½œæ–¹æ³•</h2>
                <div class="controls-grid">
                    <div class="control-key">â† â†’ / A D</div>
                    <div class="control-desc">è‡ªæ©Ÿã‚’å·¦å³ã«ç§»å‹•</div>
                    
                    <div class="control-key">SPACE</div>
                    <div class="control-desc">å¼¾ã‚’ç™ºå°„ï¼ˆé•·æŠ¼ã—ã§é€£å°„ï¼‰</div>
                </div>
            </div>

            <div class="tutorial-section">
                <h2>ğŸ‘¾ æ•µã®ç¨®é¡ã¨ã‚®ãƒŸãƒƒã‚¯</h2>
                
                <div class="enemy-info">
                    <div class="enemy-visual" style="color: #f0f;">â—†</div>
                    <div class="enemy-details">
                        <div class="enemy-name">ã‚¿ã‚¤ãƒ—1ï¼ˆãƒ”ãƒ³ã‚¯ï¼‰</div>
                        <div class="enemy-description">æœ€ä¸Šåˆ—ã«é…ç½®ã€‚å‹•ããŒé…ã„ãŒã€å€’ã™ã¨10ç‚¹ç²å¾—</div>
                    </div>
                </div>

                <div class="enemy-info">
                    <div class="enemy-visual" style="color: #ff0;">â—†</div>
                    <div class="enemy-details">
                        <div class="enemy-name">ã‚¿ã‚¤ãƒ—2ï¼ˆé»„è‰²ï¼‰</div>
                        <div class="enemy-description">ä¸­åˆ—ã«é…ç½®ã€‚æ¨™æº–çš„ãªé€Ÿåº¦ã§ã€å€’ã™ã¨20ç‚¹ç²å¾—</div>
                    </div>
                </div>

                <div class="enemy-info">
                    <div class="enemy-visual" style="color: #0ff;">â—†</div>
                    <div class="enemy-details">
                        <div class="enemy-name">ã‚¿ã‚¤ãƒ—3ï¼ˆã‚·ã‚¢ãƒ³ï¼‰</div>
                        <div class="enemy-description">æœ€ä¸‹åˆ—ã«é…ç½®ã€‚ã‚„ã‚„é€Ÿãå‹•ãã€å€’ã™ã¨30ç‚¹ç²å¾—</div>
                    </div>
                </div>

                <h3>âš ï¸ æ•µã®æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
                <p style="line-height: 1.8;">
                    â€¢ æ•µã¯ä¸€å®šé–“éš”ã§ãƒ©ãƒ³ãƒ€ãƒ ã«å¼¾ã‚’ç™ºå°„<br>
                    â€¢ é›£æ˜“åº¦ãŒä¸ŠãŒã‚‹ã¨ç™ºå°„é »åº¦ã¨å¼¾é€ŸãŒå¢—åŠ <br>
                    â€¢ æ•µãŒç”»é¢ä¸‹éƒ¨ã¾ã§åˆ°é”ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼<br>
                    â€¢ æ•µã¯å·¦å³ã«ç§»å‹•ã—ã€ç«¯ã«åˆ°é”ã™ã‚‹ã¨ä¸‹ã«é™ã‚Šã¦ãã‚‹
                </p>
            </div>

            <div class="tutorial-section">
                <h2>ğŸ ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã‚¢ã‚¤ãƒ†ãƒ </h2>
                <div class="powerup-grid">
                    <div class="powerup-item powerup-health">
                        <div class="powerup-icon">ğŸ’š</div>
                        <div class="powerup-name" style="color: #0f0;">ä½“åŠ›å›å¾©</div>
                        <div class="powerup-effect">HP +30å›å¾©<br>æœ€å¤§100ã¾ã§</div>
                    </div>

                    <div class="powerup-item powerup-shield">
                        <div class="powerup-icon">ğŸ›¡ï¸</div>
                        <div class="powerup-name" style="color: #0ff;">ã‚·ãƒ¼ãƒ«ãƒ‰</div>
                        <div class="powerup-effect">5ç§’é–“ç„¡æ•µ<br>æ•µå¼¾ã‚’ç„¡åŠ¹åŒ–</div>
                    </div>

                    <div class="powerup-item powerup-triple">
                        <div class="powerup-icon">âš¡</div>
                        <div class="powerup-name" style="color: #ff0;">ä¸‰æ–¹å‘å¼¾</div>
                        <div class="powerup-effect">8ç§’é–“3æ–¹å‘ã«ç™ºå°„<br>åºƒç¯„å›²æ”»æ’ƒ</div>
                    </div>

                    <div class="powerup-item powerup-laser">
                        <div class="powerup-icon">ğŸ”«</div>
                        <div class="powerup-name" style="color: #f0f;">ãƒ¬ãƒ¼ã‚¶ãƒ¼</div>
                        <div class="powerup-effect">8ç§’é–“è²«é€šãƒ¬ãƒ¼ã‚¶ãƒ¼<br>è¤‡æ•°ã®æ•µã‚’åŒæ™‚æ’ƒç ´</div>
                    </div>
                </div>
                <p style="margin-top: 15px; color: #aaa; font-size: 14px;">
                    â€» ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã¯æ•µã‚’å€’ã™ã¨ãƒ©ãƒ³ãƒ€ãƒ ã§å‡ºç¾<br>
                    â€» é›£æ˜“åº¦ãŒé«˜ã„ã»ã©å‡ºç¾ç‡ãŒä½ä¸‹
                </p>
            </div>

            <div class="tutorial-section">
                <h2>ğŸ”¥ ã‚³ãƒ³ãƒœã‚·ã‚¹ãƒ†ãƒ </h2>
                <p style="line-height: 1.8;">
                    â€¢ é€£ç¶šã—ã¦æ•µã‚’å€’ã™ã¨ã‚³ãƒ³ãƒœãŒç™ºç”Ÿ<br>
                    â€¢ ã‚³ãƒ³ãƒœæ•°ã«å¿œã˜ã¦ã‚¹ã‚³ã‚¢ãŒå€å¢—ï¼ˆ2å€ã€3å€ã€4å€...ï¼‰<br>
                    â€¢ ä¸€å®šæ™‚é–“æ•µã‚’å€’ã•ãªã„ã¨ã‚³ãƒ³ãƒœãŒãƒªã‚»ãƒƒãƒˆ<br>
                    â€¢ é«˜å¾—ç‚¹ã‚’ç‹™ã†ãªã‚‰ã€ç´ æ—©ãé€£ç¶šæ’ƒç ´ã‚’ç‹™ãŠã†ï¼
                </p>
            </div>

            <div class="tutorial-section">
                <h2>ğŸ“Š ã‚¹ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ </h2>
                <p style="line-height: 1.8;">
                    <strong style="color: #ff0;">åŸºæœ¬ã‚¹ã‚³ã‚¢ï¼š</strong><br>
                    â€¢ ã‚¿ã‚¤ãƒ—1: 10ç‚¹<br>
                    â€¢ ã‚¿ã‚¤ãƒ—2: 20ç‚¹<br>
                    â€¢ ã‚¿ã‚¤ãƒ—3: 30ç‚¹<br>
                    <br>
                    <strong style="color: #ff0;">ãƒœãƒ¼ãƒŠã‚¹ï¼š</strong><br>
                    â€¢ ã‚³ãƒ³ãƒœå€ç‡ãŒé©ç”¨ã•ã‚Œã‚‹<br>
                    â€¢ ã‚¦ã‚§ãƒ¼ãƒ–ã‚¯ãƒªã‚¢: ã‚¦ã‚§ãƒ¼ãƒ–æ•° Ã— 100ç‚¹<br>
                    <br>
                    <strong style="color: #0ff;">ä¾‹ï¼š</strong> ã‚¿ã‚¤ãƒ—3ã‚’3ã‚³ãƒ³ãƒœã§å€’ã™<br>
                    â†’ 30ç‚¹ Ã— 3å€ = 90ç‚¹ï¼
                </p>
            </div>

            <div class="tutorial-section">
                <h2>ğŸ’¡ æ”»ç•¥ã®ã‚³ãƒ„</h2>
                <ul class="tips-list">
                    <li>æœ€åˆã¯ä¸‹ã®åˆ—ã®æ•µã‹ã‚‰å€’ã™ã¨å®‰å…¨</li>
                    <li>ç”»é¢ã®ç«¯ã‚’ä½¿ã£ã¦æ•µå¼¾ã‚’é¿ã‘ã‚„ã™ãã™ã‚‹</li>
                    <li>ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã¯ç©æ¥µçš„ã«å–ã‚ã†ï¼ˆç‰¹ã«ã‚·ãƒ¼ãƒ«ãƒ‰ï¼‰</li>
                    <li>ã‚³ãƒ³ãƒœã‚’æ„è­˜ã—ã¦é€£ç¶šæ’ƒç ´ã‚’ç‹™ã†</li>
                    <li>ä¸‰æ–¹å‘å¼¾ã‚„ãƒ¬ãƒ¼ã‚¶ãƒ¼ã¯æ¸©å­˜ã›ãšç©æ¥µçš„ã«ä½¿ã†</li>
                    <li>æ•µãŒé™ã‚Šã¦ãã‚‹å‰ã«å€’ã—åˆ‡ã‚‹ã“ã¨ãŒé‡è¦</li>
                    <li>ä½“åŠ›ã¯å¸¸ã«50ä»¥ä¸Šã‚­ãƒ¼ãƒ—ã‚’å¿ƒãŒã‘ã‚‹</li>
                </ul>
            </div>

            <div class="tutorial-section">
                <h2>ğŸšï¸ é›£æ˜“åº¦ã«ã¤ã„ã¦ï¼ˆå…¨10æ®µéšï¼‰</h2>
                <p style="line-height: 1.8;">
                    <strong style="color: #0f0;">Lv.1-3ï¼ˆåˆç´šãƒ»ç°¡å˜ãƒ»æ™®é€šï¼‰ï¼š</strong> åˆå¿ƒè€…ã«ãŠã™ã™ã‚<br>
                    <strong style="color: #ff0;">Lv.4-6ï¼ˆä¸Šç´šãƒ»ç†Ÿç·´ãƒ»é”äººï¼‰ï¼š</strong> æœ¬æ ¼çš„ãªæŒ‘æˆ¦<br>
                    <strong style="color: #f60;">Lv.7-8ï¼ˆè¶…ç´šãƒ»æ‚ªå¤¢ï¼‰ï¼š</strong> ä¸Šç´šè€…å‘ã‘<br>
                    <strong style="color: #f00;">Lv.9-10ï¼ˆç‹‚æ°—ãƒ»åœ°ç„ï¼‰ï¼š</strong> æ¥µé™ã®é›£æ˜“åº¦<br>
                    <br>
                    é›£æ˜“åº¦ãŒä¸ŠãŒã‚‹ã¨ï¼š<br>
                    â€¢ æ•µã®ç§»å‹•é€Ÿåº¦ãŒå¢—åŠ <br>
                    â€¢ æ•µã®å¼¾é€Ÿã¨ç™ºå°„é »åº¦ãŒä¸Šæ˜‡<br>
                    â€¢ è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸ãŒå¢—åŠ <br>
                    â€¢ ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—å‡ºç¾ç‡ãŒä½ä¸‹
                </p>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showDifficulty()" style="font-size: 22px; padding: 20px 50px;">
                    é›£æ˜“åº¦ã‚’é¸ã‚“ã§é–‹å§‹ï¼
                </button>
                <button class="btn" onclick="backToStartFromTutorial()" style="margin-top: 15px; font-size: 16px; background: rgba(255,255,255,0.1);">
                    ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹
                </button>
            </div>

            <div class="scroll-hint">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦å…¨ã¦ã®èª¬æ˜ã‚’èª­ã‚‚ã† â†“</div>
        </div>
        <div id="difficultyScreen">
            <h1>é›£æ˜“åº¦ã‚’é¸æŠ</h1>
            <div class="difficulty-grid">
                <button class="difficulty-btn difficulty-beginner" onclick="startGame('beginner')">
                    <div class="difficulty-title">ğŸŒŸ Lv.1</div>
                    <div class="difficulty-desc">â˜…â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†<br>åˆç´š</div>
                </button>
                <button class="difficulty-btn difficulty-easy" onclick="startGame('easy')">
                    <div class="difficulty-title">ğŸŒ± Lv.2</div>
                    <div class="difficulty-desc">â˜…â˜…â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†<br>ç°¡å˜</div>
                </button>
                <button class="difficulty-btn difficulty-normal" onclick="startGame('normal')">
                    <div class="difficulty-title">âš¡ Lv.3</div>
                    <div class="difficulty-desc">â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†â˜†â˜†<br>æ™®é€š</div>
                </button>
                <button class="difficulty-btn difficulty-advanced" onclick="startGame('advanced')">
                    <div class="difficulty-title">ğŸ”¥ Lv.4</div>
                    <div class="difficulty-desc">â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†â˜†<br>ä¸Šç´š</div>
                </button>
                <button class="difficulty-btn difficulty-expert" onclick="startGame('expert')">
                    <div class="difficulty-title">âš”ï¸ Lv.5</div>
                    <div class="difficulty-desc">â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†<br>ç†Ÿç·´</div>
                </button>
                <button class="difficulty-btn difficulty-master" onclick="startGame('master')">
                    <div class="difficulty-title">ğŸ‘‘ Lv.6</div>
                    <div class="difficulty-desc">â˜…â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†<br>é”äºº</div>
                </button>
                <button class="difficulty-btn difficulty-extreme" onclick="startGame('extreme')">
                    <div class="difficulty-title">ğŸ’€ Lv.7</div>
                    <div class="difficulty-desc">â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†<br>è¶…ç´š</div>
                </button>
                <button class="difficulty-btn difficulty-nightmare" onclick="startGame('nightmare')">
                    <div class="difficulty-title">ğŸ˜ˆ Lv.8</div>
                    <div class="difficulty-desc">â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜†â˜†<br>æ‚ªå¤¢</div>
                </button>
                <button class="difficulty-btn difficulty-insane" onclick="startGame('insane')">
                    <div class="difficulty-title">ğŸŒ€ Lv.9</div>
                    <div class="difficulty-desc">â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜†<br>ç‹‚æ°—</div>
                </button>
                <button class="difficulty-btn difficulty-hell" onclick="startGame('hell')">
                    <div class="difficulty-title">ğŸ”¥ğŸ’€ Lv.10</div>
                    <div class="difficulty-desc">â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…<br>åœ°ç„</div>
                </button>
            </div>
            <button class="btn" onclick="backToStart()" style="margin-top: 30px; font-size: 16px;">æˆ»ã‚‹</button>
        </div>
        <div id="gameOver">
            <h1>GAME OVER</h1>
            <div class="wave-info">æœ€çµ‚ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></div>
            <div class="wave-info">ğŸ† ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="highScore">0</span></div>
            <div class="wave-info">åˆ°é”WAVE: <span id="finalWave">1</span></div>
            <div class="wave-info">é›£æ˜“åº¦: <span id="finalDifficulty">ä¸­ç´š</span></div>
            <div style="margin-top: 20px; padding: 20px; background: rgba(0,255,255,0.1); border-radius: 10px;">
                <div class="wave-info" style="font-size: 18px; margin: 8px 0;">ğŸ’€ å€’ã—ãŸæ•µ: <span id="finalKills">0</span>ä½“</div>
                <div class="wave-info" style="font-size: 18px; margin: 8px 0;">ğŸ”¥ æœ€å¤§ã‚³ãƒ³ãƒœ: <span id="finalMaxCombo">0</span>é€£é–</div>
                <div class="wave-info" style="font-size: 18px; margin: 8px 0;">âœ… ã‚¯ãƒªã‚¢WAVE: <span id="finalWavesCleared">0</span>å›</div>
            </div>
            <button class="btn" onclick="retryGame()">åŒã˜é›£æ˜“åº¦ã§ãƒªãƒˆãƒ©ã‚¤</button>
            <button class="btn" onclick="changeDifficulty()" style="margin-left: 10px;">é›£æ˜“åº¦ã‚’å¤‰æ›´</button>
        </div>
        <div id="combo"></div>
        <div id="controlHints">
            <div class="hint-item">
                <div class="hint-keys">
                    <div class="hint-key">â†</div>
                    <div class="hint-key">â†’</div>
                </div>
                <div class="hint-desc">ã¾ãŸã¯</div>
                <div class="hint-keys">
                    <div class="hint-key">A</div>
                    <div class="hint-key">D</div>
                </div>
                <div class="hint-desc">ç§»å‹•</div>
            </div>
            <div class="hint-item">
                <div class="hint-keys">
                    <div class="hint-key">SPACE</div>
                </div>
                <div class="hint-desc">é•·æŠ¼ã—ã§é€£å°„</div>
            </div>
        </div>
        <div id="powerupNotification"></div>
        <div id="powerupTimer"></div>
        
        <!-- å¸¸æ™‚è¡¨ç¤ºã®æ“ä½œèª¬æ˜ï¼ˆå³ä¸Šï¼‰ -->
        <div id="permanentControls">
            <h4>ğŸ® æ“ä½œæ–¹æ³•</h4>
            <ul>
                <li>â† â†’ / A D: ç§»å‹•</li>
                <li>SPACE: é€£å°„</li>
            </ul>
        </div>
        
        <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¿ãƒƒãƒãƒœã‚¿ãƒ³ -->
        <div id="mobileControls">
            <div class="mobile-buttons">
                <div class="mobile-btn" id="btnLeft">â†</div>
                <div class="mobile-btn" id="btnRight">â†’</div>
            </div>
            <div class="mobile-buttons">
                <div class="mobile-btn mobile-shoot-btn" id="btnShoot">ç™ºå°„</div>
            </div>
        </div>
        
        <!-- ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
        <div id="startOverlay">
            <div class="message">æº–å‚™å®Œäº†ï¼</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼šç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’èª¿æ•´
        function adjustCanvasSize() {
            const container = document.getElementById('gameContainer');
            const isLandscape = window.innerWidth > window.innerHeight;
            const isMobileDevice = isMobile;
            
            if (isMobileDevice) {
                if (isLandscape) {
                    // æ¨ªç”»é¢ï¼šé«˜ã•ã‚’åŸºæº–ã«
                    const maxHeight = window.innerHeight * 0.95;
                    const ratio = 800 / 700; // å…ƒã®æ¯”ç‡
                    canvas.style.height = maxHeight + 'px';
                    canvas.style.width = (maxHeight * ratio) + 'px';
                } else {
                    // ç¸¦ç”»é¢ï¼šå¹…ã‚’åŸºæº–ã«
                    const maxWidth = window.innerWidth;
                    const ratio = 700 / 800; // å…ƒã®æ¯”ç‡ï¼ˆé€†ï¼‰
                    canvas.style.width = maxWidth + 'px';
                    canvas.style.height = (maxWidth * ratio) + 'px';
                }
            }
        }
        
        // åˆæœŸã‚µã‚¤ã‚ºèª¿æ•´
        adjustCanvasSize();
        
        // ç”»é¢å›è»¢ãƒ»ãƒªã‚µã‚¤ã‚ºæ™‚ã«å†èª¿æ•´
        window.addEventListener('resize', adjustCanvasSize);
        window.addEventListener('orientationchange', () => {
            setTimeout(adjustCanvasSize, 100);
        });

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            player: {
                x: 375,
                y: 630,
                width: 50,
                height: 40,
                speed: 6,
                health: 100,
                maxHealth: 100,
                weapon: 'normal',
                shield: false,
                weaponTimer: 0
            },
            bullets: [],
            invaders: [],
            invaderBullets: [],
            particles: [],
            powerUps: [],
            stars: [],
            score: 0,
            wave: 1,
            gameOver: false,
            gameStarted: false,
            shootCooldown: 0,
            invaderSpeed: 0.5,
            invaderDirection: 1,
            combo: 0,
            comboTimer: 0,
            time: 0,
            difficulty: 'normal',
            // çµ±è¨ˆæƒ…å ±
            stats: {
                totalKills: 0,
                maxCombo: 0,
                wavesCleared: 0
            },
            controlHintsShown: false
        };

        // é›£æ˜“åº¦è¨­å®šï¼ˆ10æ®µéšï¼‰
        const difficultySettings = {
            beginner: {
                name: 'åˆç´š',
                level: 1,
                stars: 'â˜…â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†',
                invaderBaseSpeed: 0.15,
                invaderSpeedIncrease: 0.08,
                invaderShootFrequency: 250,
                invaderInitialDelay: 4000,
                bulletSpeed: 1.2,
                bulletSpeedIncrease: 0.05,
                powerUpChance: 0.35,
                initialRows: 2,
                maxRows: 4,
                playerSpeed: 7,
                enemyDamage: 4
            },
            easy: {
                name: 'ç°¡å˜',
                level: 2,
                stars: 'â˜…â˜…â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†',
                invaderBaseSpeed: 0.25,
                invaderSpeedIncrease: 0.1,
                invaderShootFrequency: 200,
                invaderInitialDelay: 3000,
                bulletSpeed: 1.5,
                bulletSpeedIncrease: 0.08,
                powerUpChance: 0.3,
                initialRows: 2,
                maxRows: 4,
                playerSpeed: 7,
                enemyDamage: 5
            },
            normal: {
                name: 'æ™®é€š',
                level: 3,
                stars: 'â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†â˜†â˜†',
                invaderBaseSpeed: 0.35,
                invaderSpeedIncrease: 0.15,
                invaderShootFrequency: 150,
                invaderInitialDelay: 2000,
                bulletSpeed: 2,
                bulletSpeedIncrease: 0.1,
                powerUpChance: 0.25,
                initialRows: 3,
                maxRows: 5,
                playerSpeed: 6.5,
                enemyDamage: 7
            },
            advanced: {
                name: 'ä¸Šç´š',
                level: 4,
                stars: 'â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†â˜†',
                invaderBaseSpeed: 0.5,
                invaderSpeedIncrease: 0.2,
                invaderShootFrequency: 120,
                invaderInitialDelay: 1500,
                bulletSpeed: 2.5,
                bulletSpeedIncrease: 0.15,
                powerUpChance: 0.2,
                initialRows: 4,
                maxRows: 6,
                playerSpeed: 6,
                enemyDamage: 10
            },
            expert: {
                name: 'ç†Ÿç·´',
                level: 5,
                stars: 'â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†',
                invaderBaseSpeed: 0.65,
                invaderSpeedIncrease: 0.25,
                invaderShootFrequency: 100,
                invaderInitialDelay: 1200,
                bulletSpeed: 3,
                bulletSpeedIncrease: 0.18,
                powerUpChance: 0.18,
                initialRows: 4,
                maxRows: 6,
                playerSpeed: 6.5,
                enemyDamage: 12
            },
            master: {
                name: 'é”äºº',
                level: 6,
                stars: 'â˜…â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†',
                invaderBaseSpeed: 0.8,
                invaderSpeedIncrease: 0.3,
                invaderShootFrequency: 80,
                invaderInitialDelay: 1000,
                bulletSpeed: 3.5,
                bulletSpeedIncrease: 0.2,
                powerUpChance: 0.15,
                initialRows: 5,
                maxRows: 7,
                playerSpeed: 7,
                enemyDamage: 14
            },
            extreme: {
                name: 'è¶…ç´š',
                level: 7,
                stars: 'â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†',
                invaderBaseSpeed: 1.0,
                invaderSpeedIncrease: 0.4,
                invaderShootFrequency: 65,
                invaderInitialDelay: 800,
                bulletSpeed: 4,
                bulletSpeedIncrease: 0.25,
                powerUpChance: 0.12,
                initialRows: 5,
                maxRows: 7,
                playerSpeed: 7.5,
                enemyDamage: 16
            },
            nightmare: {
                name: 'æ‚ªå¤¢',
                level: 8,
                stars: 'â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜†â˜†',
                invaderBaseSpeed: 1.2,
                invaderSpeedIncrease: 0.5,
                invaderShootFrequency: 50,
                invaderInitialDelay: 500,
                bulletSpeed: 4.5,
                bulletSpeedIncrease: 0.3,
                powerUpChance: 0.1,
                initialRows: 6,
                maxRows: 8,
                playerSpeed: 8,
                enemyDamage: 18
            },
            insane: {
                name: 'ç‹‚æ°—',
                level: 9,
                stars: 'â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜†',
                invaderBaseSpeed: 1.4,
                invaderSpeedIncrease: 0.6,
                invaderShootFrequency: 40,
                invaderInitialDelay: 300,
                bulletSpeed: 5,
                bulletSpeedIncrease: 0.35,
                powerUpChance: 0.08,
                initialRows: 6,
                maxRows: 8,
                playerSpeed: 8.5,
                enemyDamage: 20
            },
            hell: {
                name: 'åœ°ç„',
                level: 10,
                stars: 'â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…',
                invaderBaseSpeed: 1.6,
                invaderSpeedIncrease: 0.7,
                invaderShootFrequency: 30,
                invaderInitialDelay: 0,
                bulletSpeed: 5.5,
                bulletSpeedIncrease: 0.4,
                powerUpChance: 0.06,
                initialRows: 7,
                maxRows: 9,
                playerSpeed: 9,
                enemyDamage: 25
            }
        };

        const keys = {};
        
        // ãƒ¢ãƒã‚¤ãƒ«æ¤œå‡º
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                         window.innerWidth <= 768;
        
        // ã‚¿ãƒƒãƒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«çŠ¶æ…‹
        let touchControls = {
            left: false,
            right: false,
            shoot: false
        };

        // æ˜Ÿã®èƒŒæ™¯ç”Ÿæˆ
        for (let i = 0; i < 100; i++) {
            gameState.stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2,
                speed: Math.random() * 0.5 + 0.2
            });
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ') {
                e.preventDefault();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // ãƒ¢ãƒã‚¤ãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®åˆæœŸåŒ–
        if (isMobile) {
            document.getElementById('mobileControls').classList.add('show');
            
            // å·¦ãƒœã‚¿ãƒ³
            const btnLeft = document.getElementById('btnLeft');
            btnLeft.addEventListener('touchstart', (e) => {
                e.preventDefault();
                touchControls.left = true;
            });
            btnLeft.addEventListener('touchend', (e) => {
                e.preventDefault();
                touchControls.left = false;
            });
            
            // å³ãƒœã‚¿ãƒ³
            const btnRight = document.getElementById('btnRight');
            btnRight.addEventListener('touchstart', (e) => {
                e.preventDefault();
                touchControls.right = true;
            });
            btnRight.addEventListener('touchend', (e) => {
                e.preventDefault();
                touchControls.right = false;
            });
            
            // ç™ºå°„ãƒœã‚¿ãƒ³
            const btnShoot = document.getElementById('btnShoot');
            btnShoot.addEventListener('touchstart', (e) => {
                e.preventDefault();
                touchControls.shoot = true;
            });
            btnShoot.addEventListener('touchend', (e) => {
                e.preventDefault();
                touchControls.shoot = false;
            });
        }

        function showDifficulty() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('tutorialScreen').style.display = 'none';
            document.getElementById('difficultyScreen').style.display = 'block';
        }

        function showTutorial() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('tutorialScreen').style.display = 'block';
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€ç•ªä¸Šã«
            document.getElementById('tutorialScreen').scrollTop = 0;
        }

        function backToStart() {
            document.getElementById('difficultyScreen').style.display = 'none';
            document.getElementById('tutorialScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
        }

        function backToStartFromTutorial() {
            document.getElementById('tutorialScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
        }

        function startGame(difficulty = 'normal') {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('difficultyScreen').style.display = 'none';
            document.getElementById('gameOver').style.display = 'none';
            
            const settings = difficultySettings[difficulty];
            
            gameState = {
                player: {
                    x: 375,
                    y: 630,
                    width: 50,
                    height: 40,
                    speed: settings.playerSpeed,
                    health: 100,
                    maxHealth: 100,
                    weapon: 'normal',
                    shield: false,
                    weaponTimer: 0
                },
                bullets: [],
                invaders: [],
                invaderBullets: [],
                particles: [],
                powerUps: [],
                stars: gameState.stars,
                score: 0,
                wave: 1,
                gameOver: false,
                gameStarted: true,
                shootCooldown: 0,
                invaderSpeed: settings.invaderBaseSpeed,
                invaderDirection: 1,
                combo: 0,
                comboTimer: 0,
                time: 0,
                difficulty: difficulty,
                stats: {
                    totalKills: 0,
                    maxCombo: 0,
                    wavesCleared: 0
                },
                controlHintsShown: false,
                invaderCanShoot: false // åˆæœŸæ”»æ’ƒé…å»¶ç”¨
            };

            createInvaders();
            updateUI();
            
            // ã‚²ãƒ¼ãƒ é–‹å§‹ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆæ”¹å–„ç‰ˆï¼‰
            // 1. æ“ä½œãƒ’ãƒ³ãƒˆã‚’5ç§’é–“è¡¨ç¤º
            document.getElementById('controlHints').classList.add('show');
            document.getElementById('startOverlay').classList.add('show');
            
            setTimeout(() => {
                // 2. æ“ä½œãƒ’ãƒ³ãƒˆã‚’éè¡¨ç¤º
                document.getElementById('controlHints').classList.remove('show');
                
                // 3. 2ç§’å¾…ã£ã¦ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤º
                setTimeout(() => {
                    document.getElementById('startOverlay').classList.remove('show');
                    
                    // 4. ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãŒå®Œå…¨ã«æ¶ˆãˆã¦ã‹ã‚‰æ•µã®æ”»æ’ƒé–‹å§‹
                    // ï¼ˆCSSãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³0.5ç§’ + ä½™è£•0.5ç§’ = 1ç§’å¾Œï¼‰
                    setTimeout(() => {
                        setTimeout(() => {
                            gameState.invaderCanShoot = true;
                        }, settings.invaderInitialDelay);
                    }, 1000);
                }, 2000);
            }, 5000);
        }

        function createInvaders() {
            gameState.invaders = [];
            const settings = difficultySettings[gameState.difficulty];
            const rows = Math.min(settings.initialRows + Math.floor(gameState.wave / 3), settings.maxRows);
            const cols = 8;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    gameState.invaders.push({
                        x: col * 90 + 50,
                        y: row * 60 + 50,
                        width: 40,
                        height: 35,
                        alive: true,
                        type: row % 3,
                        animFrame: 0,
                        shootTimer: Math.random() * settings.invaderShootFrequency
                    });
                }
            }
        }

        function shoot() {
            const player = gameState.player;
            
            if (player.weapon === 'triple') {
                // ä¸‰æ–¹å‘å¼¾
                gameState.bullets.push(
                    { x: player.x + player.width / 2 - 3, y: player.y, width: 6, height: 15, speed: 8, vx: -1, vy: -8, damage: 1 },
                    { x: player.x + player.width / 2 - 3, y: player.y, width: 6, height: 15, speed: 8, vx: 0, vy: -8, damage: 1 },
                    { x: player.x + player.width / 2 - 3, y: player.y, width: 6, height: 15, speed: 8, vx: 1, vy: -8, damage: 1 }
                );
                gameState.shootCooldown = 20;
            } else if (player.weapon === 'laser') {
                // ãƒ¬ãƒ¼ã‚¶ãƒ¼
                gameState.bullets.push({
                    x: player.x + player.width / 2 - 4,
                    y: player.y,
                    width: 8,
                    height: player.y,
                    speed: 0,
                    vx: 0,
                    vy: 0,
                    damage: 3,
                    laser: true,
                    life: 10
                });
                gameState.shootCooldown = 40;
            } else {
                // é€šå¸¸å¼¾
                gameState.bullets.push({
                    x: player.x + player.width / 2 - 3,
                    y: player.y,
                    width: 6,
                    height: 15,
                    speed: 8,
                    vx: 0,
                    vy: -8,
                    damage: 1
                });
                gameState.shootCooldown = 15;
            }

            // ç™ºå°„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
            createParticles(player.x + player.width / 2, player.y, '#0ff', 5);
        }

        function invaderShoot(invader) {
            const settings = difficultySettings[gameState.difficulty];
            invader.shootTimer = settings.invaderShootFrequency + Math.random() * settings.invaderShootFrequency;
            gameState.invaderBullets.push({
                x: invader.x + invader.width / 2 - 3,
                y: invader.y + invader.height,
                width: 6,
                height: 12,
                speed: settings.bulletSpeed + gameState.wave * settings.bulletSpeedIncrease
            });
        }

        function createParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 1;
                gameState.particles.push({
                    x, y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    size: Math.random() * 3 + 2,
                    color,
                    life: 30,
                    maxLife: 30
                });
            }
        }

        function createExplosion(x, y, size) {
            createParticles(x, y, '#ff6600', size);
            createParticles(x, y, '#ffff00', size);
            createParticles(x, y, '#ff0000', size / 2);
        }

        function spawnPowerUp(x, y) {
            const settings = difficultySettings[gameState.difficulty];
            if (Math.random() < settings.powerUpChance) {
                const types = ['health', 'shield', 'triple', 'laser'];
                gameState.powerUps.push({
                    x, y,
                    width: 30,
                    height: 30,
                    type: types[Math.floor(Math.random() * types.length)],
                    vy: 2
                });
            }
        }

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function showCombo() {
            if (gameState.combo > 2) {
                const comboEl = document.getElementById('combo');
                comboEl.textContent = `${gameState.combo}x COMBO!`;
                comboEl.style.animation = 'none';
                setTimeout(() => {
                    comboEl.style.animation = 'comboAnim 1s ease-out';
                }, 10);
            }
        }

        function update() {
            if (!gameState.gameStarted || gameState.gameOver) return;

            gameState.time++;

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•ï¼ˆçŸ¢å°ã‚­ãƒ¼ã¾ãŸã¯WASD ã¾ãŸã¯ã‚¿ãƒƒãƒï¼‰
            const player = gameState.player;
            if ((keys['ArrowLeft'] || keys['a'] || keys['A'] || touchControls.left) && player.x > 0) {
                player.x -= player.speed;
            }
            if ((keys['ArrowRight'] || keys['d'] || keys['D'] || touchControls.right) && player.x < canvas.width - player.width) {
                player.x += player.speed;
            }

            // ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
            if (gameState.shootCooldown > 0) {
                gameState.shootCooldown--;
            }

            // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼é•·æŠ¼ã—ã¾ãŸã¯ã‚¿ãƒƒãƒã§é€£å°„
            if ((keys[' '] || touchControls.shoot) && gameState.shootCooldown === 0) {
                shoot();
            }

            // ã‚³ãƒ³ãƒœã‚¿ã‚¤ãƒãƒ¼
            if (gameState.comboTimer > 0) {
                gameState.comboTimer--;
            } else {
                gameState.combo = 0;
            }

            // æ˜Ÿã®ç§»å‹•
            gameState.stars.forEach(star => {
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });

            // å¼¾ã®æ›´æ–°
            gameState.bullets = gameState.bullets.filter(bullet => {
                if (bullet.laser) {
                    bullet.life--;
                    return bullet.life > 0;
                }
                bullet.x += bullet.vx || 0;
                bullet.y += bullet.vy || -bullet.speed;
                return bullet.y > -bullet.height;
            });

            // ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ã®å¼¾
            gameState.invaderBullets = gameState.invaderBullets.filter(bullet => {
                bullet.y += bullet.speed;
                
                if (checkCollision(bullet, player)) {
                    if (!player.shield) {
                        const settings = difficultySettings[gameState.difficulty];
                        player.health -= settings.enemyDamage;
                        updateUI();
                        createExplosion(bullet.x, bullet.y, 10);
                        
                        if (player.health <= 0) {
                            endGame();
                        }
                    } else {
                        createParticles(bullet.x, bullet.y, '#0ff', 5);
                    }
                    return false;
                }
                
                return bullet.y < canvas.height;
            });

            // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—
            gameState.powerUps = gameState.powerUps.filter(powerUp => {
                powerUp.y += powerUp.vy;
                
                if (checkCollision(powerUp, player)) {
                    let notificationText = '';
                    let notificationColor = '';
                    
                    switch(powerUp.type) {
                        case 'health':
                            player.health = Math.min(player.maxHealth, player.health + 30);
                            notificationText = 'ğŸ’š ä½“åŠ›å›å¾© +30HP';
                            notificationColor = '#0f0';
                            break;
                        case 'shield':
                            player.shield = true;
                            player.weaponTimer = 5000;
                            notificationText = 'ğŸ›¡ï¸ ã‚·ãƒ¼ãƒ«ãƒ‰ç™ºå‹•ï¼ 5ç§’é–“ç„¡æ•µ';
                            notificationColor = '#0ff';
                            setTimeout(() => player.shield = false, 5000);
                            break;
                        case 'triple':
                            player.weapon = powerUp.type;
                            player.weaponTimer = 8000;
                            notificationText = 'âš¡ ä¸‰æ–¹å‘ã‚·ãƒ§ãƒƒãƒˆï¼ 8ç§’é–“æœ‰åŠ¹';
                            notificationColor = '#ff0';
                            setTimeout(() => player.weapon = 'normal', 8000);
                            break;
                        case 'laser':
                            player.weapon = powerUp.type;
                            player.weaponTimer = 8000;
                            notificationText = 'ğŸ”« è²«é€šãƒ¬ãƒ¼ã‚¶ãƒ¼ï¼ 8ç§’é–“æœ‰åŠ¹';
                            notificationColor = '#f0f';
                            setTimeout(() => player.weapon = 'normal', 8000);
                            break;
                    }
                    
                    // é€šçŸ¥ã‚’è¡¨ç¤º
                    const notification = document.getElementById('powerupNotification');
                    notification.textContent = notificationText;
                    notification.style.borderColor = notificationColor;
                    notification.style.color = notificationColor;
                    notification.classList.add('show');
                    
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 3000);
                    
                    createParticles(powerUp.x, powerUp.y, '#0f0', 15);
                    updateUI();
                    return false;
                }
                
                return powerUp.y < canvas.height;
            });

            // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
            if (player.weaponTimer > 0) {
                player.weaponTimer -= 16; // ç´„16ms per frame
                const timer = document.getElementById('powerupTimer');
                const seconds = Math.ceil(player.weaponTimer / 1000);
                if (seconds > 0) {
                    timer.textContent = `æ®‹ã‚Š ${seconds} ç§’`;
                    timer.classList.add('show');
                } else {
                    timer.classList.remove('show');
                    player.weaponTimer = 0;
                }
            }

            // ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ç§»å‹•
            let shouldMoveDown = false;
            gameState.invaders.forEach(invader => {
                if (!invader.alive) return;
                
                invader.animFrame = (invader.animFrame + 0.1) % 2;
                invader.x += gameState.invaderSpeed * gameState.invaderDirection;
                
                if (invader.x <= 0 || invader.x >= canvas.width - invader.width) {
                    shouldMoveDown = true;
                }

                // ç™ºå°„ï¼ˆåˆæœŸé…å»¶å¾Œã®ã¿ï¼‰
                if (gameState.invaderCanShoot) {
                    invader.shootTimer--;
                    if (invader.shootTimer <= 0) {
                        invaderShoot(invader);
                    }
                }
            });

            if (shouldMoveDown) {
                gameState.invaderDirection *= -1;
                gameState.invaders.forEach(invader => {
                    invader.y += 30;
                    if (invader.alive && invader.y + invader.height >= player.y) {
                        endGame();
                    }
                });
            }

            // å¼¾ã¨ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ã®è¡çª
            gameState.bullets.forEach((bullet, bIndex) => {
                gameState.invaders.forEach(invader => {
                    if (invader.alive && checkCollision(bullet, invader)) {
                        invader.alive = false;
                        
                        const points = (invader.type + 1) * 10 * (gameState.combo + 1);
                        gameState.score += points;
                        gameState.combo++;
                        gameState.comboTimer = 60;
                        
                        // çµ±è¨ˆæƒ…å ±æ›´æ–°
                        gameState.stats.totalKills++;
                        if (gameState.combo > gameState.stats.maxCombo) {
                            gameState.stats.maxCombo = gameState.combo;
                        }
                        
                        showCombo();
                        
                        if (!bullet.laser) {
                            gameState.bullets.splice(bIndex, 1);
                        }
                        
                        createExplosion(invader.x + invader.width / 2, invader.y + invader.height / 2, 20);
                        spawnPowerUp(invader.x + invader.width / 2, invader.y + invader.height / 2);
                        updateUI();
                    }
                });
            });

            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ›´æ–°
            gameState.particles = gameState.particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                return p.life > 0;
            });

            // å…¨æ»…ãƒã‚§ãƒƒã‚¯
            if (gameState.invaders.every(inv => !inv.alive)) {
                gameState.wave++;
                gameState.stats.wavesCleared++;
                const settings = difficultySettings[gameState.difficulty];
                gameState.invaderSpeed += settings.invaderSpeedIncrease;
                createInvaders();
                gameState.score += gameState.wave * 100;
                
                // æ–°ã—ã„ã‚¦ã‚§ãƒ¼ãƒ–ã§åˆæœŸé…å»¶ã‚’ãƒªã‚»ãƒƒãƒˆ
                gameState.invaderCanShoot = false;
                setTimeout(() => {
                    gameState.invaderCanShoot = true;
                }, settings.invaderInitialDelay);
                
                updateUI();
            }
        }

        function draw() {
            // èƒŒæ™¯
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ˜Ÿ
            ctx.fillStyle = '#fff';
            gameState.stars.forEach(star => {
                ctx.globalAlpha = Math.random() * 0.5 + 0.5;
                ctx.fillRect(star.x, star.y, star.size, star.size);
            });
            ctx.globalAlpha = 1;

            if (!gameState.gameStarted) return;

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æç”»
            const player = gameState.player;
            
            if (player.shield) {
                ctx.strokeStyle = '#0ff';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(player.x + player.width / 2, player.y + player.height / 2, 35, 0, Math.PI * 2);
                ctx.stroke();
            }

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æœ¬ä½“
            ctx.fillStyle = '#0f0';
            ctx.beginPath();
            ctx.moveTo(player.x + player.width / 2, player.y);
            ctx.lineTo(player.x, player.y + player.height);
            ctx.lineTo(player.x + player.width, player.y + player.height);
            ctx.closePath();
            ctx.fill();

            // ã‚¨ãƒ³ã‚¸ãƒ³
            ctx.fillStyle = '#f60';
            ctx.fillRect(player.x + 10, player.y + player.height - 5, 10, 8);
            ctx.fillRect(player.x + player.width - 20, player.y + player.height - 5, 10, 8);

            // å¼¾æç”»
            gameState.bullets.forEach(bullet => {
                if (bullet.laser) {
                    const gradient = ctx.createLinearGradient(bullet.x, bullet.y, bullet.x, 0);
                    gradient.addColorStop(0, 'rgba(0, 255, 255, 0)');
                    gradient.addColorStop(0.5, 'rgba(0, 255, 255, 0.8)');
                    gradient.addColorStop(1, 'rgba(0, 255, 255, 1)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(bullet.x, 0, bullet.width, bullet.y);
                } else {
                    ctx.fillStyle = '#0ff';
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = '#0ff';
                    ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                    ctx.shadowBlur = 0;
                }
            });

            // ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ã®å¼¾
            gameState.invaderBullets.forEach(bullet => {
                ctx.fillStyle = '#f0f';
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#f0f';
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                ctx.shadowBlur = 0;
            });

            // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—
            gameState.powerUps.forEach(powerUp => {
                ctx.save();
                ctx.translate(powerUp.x + powerUp.width / 2, powerUp.y + powerUp.height / 2);
                ctx.rotate(gameState.time * 0.05);
                
                const colors = {
                    health: '#0f0',
                    shield: '#0ff',
                    triple: '#ff0',
                    laser: '#f0f'
                };
                
                ctx.fillStyle = colors[powerUp.type];
                ctx.shadowBlur = 15;
                ctx.shadowColor = colors[powerUp.type];
                ctx.fillRect(-powerUp.width / 2, -powerUp.height / 2, powerUp.width, powerUp.height);
                ctx.shadowBlur = 0;
                ctx.restore();
            });

            // ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼æç”»
            gameState.invaders.forEach(invader => {
                if (!invader.alive) return;

                const colors = ['#f0f', '#ff0', '#0ff'];
                ctx.fillStyle = colors[invader.type];
                
                const offset = Math.floor(invader.animFrame) * 5;
                
                // æœ¬ä½“
                ctx.fillRect(invader.x + offset, invader.y + 10, invader.width - offset * 2, invader.height - 10);
                
                // è§¦è§’
                ctx.fillRect(invader.x, invader.y, 8, 10);
                ctx.fillRect(invader.x + invader.width - 8, invader.y, 8, 10);
                
                // ç›®
                ctx.fillStyle = '#000';
                ctx.fillRect(invader.x + 10, invader.y + 15, 6, 6);
                ctx.fillRect(invader.x + invader.width - 16, invader.y + 15, 6, 6);
            });

            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
            gameState.particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / p.maxLife;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });
            ctx.globalAlpha = 1;
        }

        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('wave').textContent = gameState.wave;
            const healthPercent = (gameState.player.health / gameState.player.maxHealth) * 100;
            document.getElementById('healthFill').style.width = healthPercent + '%';
        }

        function endGame() {
            gameState.gameOver = true;
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalWave').textContent = gameState.wave;
            
            // çµ±è¨ˆæƒ…å ±è¡¨ç¤º
            document.getElementById('finalKills').textContent = gameState.stats.totalKills;
            document.getElementById('finalMaxCombo').textContent = gameState.stats.maxCombo;
            document.getElementById('finalWavesCleared').textContent = gameState.stats.wavesCleared;
            
            // ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°
            const highScoreKey = `highScore_${gameState.difficulty}`;
            const currentHighScore = localStorage.getItem(highScoreKey) || 0;
            const newHighScore = Math.max(currentHighScore, gameState.score);
            localStorage.setItem(highScoreKey, newHighScore);
            document.getElementById('highScore').textContent = newHighScore;
            
            const difficultyNames = {
                beginner: 'Lv.1 åˆç´š',
                easy: 'Lv.2 ç°¡å˜',
                normal: 'Lv.3 æ™®é€š',
                advanced: 'Lv.4 ä¸Šç´š',
                expert: 'Lv.5 ç†Ÿç·´',
                master: 'Lv.6 é”äºº',
                extreme: 'Lv.7 è¶…ç´š',
                nightmare: 'Lv.8 æ‚ªå¤¢',
                insane: 'Lv.9 ç‹‚æ°—',
                hell: 'Lv.10 åœ°ç„'
            };
            document.getElementById('finalDifficulty').textContent = difficultyNames[gameState.difficulty];
            document.getElementById('gameOver').style.display = 'block';
        }

        function retryGame() {
            startGame(gameState.difficulty);
        }

        function changeDifficulty() {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('difficultyScreen').style.display = 'block';
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
